Azure Basics

Cloud SDK and CLI
--------------------------    
[ azure cli ]
az login
az account list
az resource list

[ azure developer cli ] -- NEW
- azd acts as a template and/or a wrapper around your applicaiton to create a unified developer experience within Azure
- I can deploy my application code directly to Azure with all of the corresponding infrastructure services needed for it to function
- 
azd up


Azure Resource Graph
——————————
- a robust querying layer that extends the Azure Resource Manager platform
- can query resources with complex filtering, grouping, and sorting by resource properties across multiple subscriptions
- when an Azure resource is updated, Azure Resource Manager notifies Azure Resource Graph about the change. Azure Resource Graph then updates its database. Azure Resource Graph also does a regular full scan. This scan ensures that Azure Resource Graph data is current if there are missed notifications or when a resource is updated outside of Azure Resource Manager
- based on the KQL (Kusto Query Language)

// Examples
resources | summarize count()
resources | where type == "microsoft.network/virtualnetworks"


	

	

Azure Active Directory
-----------------------------
- azure ad tenants exist outside of the subscription 
- they are associated (or shared) with a subscription via a trust relationship
- subscriptions can only trust ONE Azure AD tenant
- they can also be associated with SaaS offerings (like O365)

[ Users ]
Synced Users - replicated from on-premises AD infra
Cloud Users - created directly in Azure AD

[ Licensing ]
- done on a per-user basis

[ Objects ]

Users

Groups
	users can be assinged dynamically based on attributes (i.e. Department name)
	
Service Principles
	these are mapped to enterprise applications or other Azure resources
	can be assumed by VMs (like Instance roles) instead of using access keys
	
Devices
	hybrird Azure AD join	
	
[ Authentication & Authorization ]

Azure AD Connect #1
	syncs users from on-prem AD structure
	takes the password hash and then hashes it again, and then stores it in AAD
	users can then authenticate against AAD and use the power of Cloud Auth
	
Pass-Through Authentication #2
	for organizations that do not trust their user info being stored in the cloud
	authentication request are sent to AAD -> request are stored in a queue
	agents that are running on the on-prem DC are polling the AAD queue
	processes those request and then sends back a response

Federation #3

Temporary Access Pass -- NEW
	great option for introducing passwordless authentication
	can define the lifetime of the pass (how long it is valid for)
	must be enabled via AAD > Security > Authentication Methods > Temporary Access Pass
	
	
	
[ Azure Active Directory Domain Services - Traditional AD Service ]
- creates (2) DCs that are fully managed
- you do not have access to them
- supports "basic" group policies
- supplies Kerberos/NTLM/LDAP interfaces for legacy apps/systems
- users created in this services DO NOT sync back to Azure AD
- replication of objects flows from Azure AD -> AADDS (uni-directional only)
**It is normally better to just extend your on-prem DC and setup custom DNS in Azure


[ Self Service Password Reset ]
- user must enroll in SSPR service in order to be able to verify identity of people trying to make changes to credentials
- SSPR is enabled at the Tenant level and is licensed on a per-user basis
- an authentication method must be set in the enrollment to help with verification (password, authenticator app, SMS, etc)
- can be enabled for "All Users" or a "Group" of users in your AAD structure
- can determine the number of auth methods needed to successfully reset (two-factor)
- passwordreset.microsoft.com (URL for resets)


[ MFA ] 
- can be enfornced based on trusted IP list (e.g user in the corporate network don't have to use MFA)
- can be enforced based on time-range using One-Time ByPass (e.g. 300 seconds, 1 hour)


[ Identity Protection ]
- enabled at the Tenant level and is licensed on a per-user basis (Premium P2 Licensing)
- automates the detection and remediation of identity-based risks
- provides data and reports within the portal
- integrate with security monitoring tools
- all about identifying RISK
- User Risk Policy: 
- Sign In Policy: 


[ Conditional Access ] 
- Premium P1 Licensing or HIGHER
- Signal (IP, device used, risk level) + Decision (block or allow access) + Enforcement
- more fine-grained policies than Identity Protection/MFA
- can define specific applications, devices, location
- can set to Report Only when just starting out in order to test drive policies in your organization


[ Privileged Identiyy Management - PIM ]
- Premium P2 Licensing
- provides just-in-time (JIT) access to an elevated role for a certain duration of time

// Configuration Options
Eligible
	the user can access PIM and optionally elevate up to use the role

Active
	I can set a time window for when the user can elevate an access the role



[ Access Reviews ]
- go to Azure AD > Identity Governance > Access Reviews
- must first onboard your Azure AD Tenant (P2 License Required)
- create reviews
- reviews access in the "Access Pane"
- supports security group and app reviews


Managed Identities
-------------------------

[ System Assigned ]
- act like Instance Roles in AWS
- cannot be shared with other resources/services
- no need to store the secret like we do when we register an application 
- supports several Azure Resources
- identity is tied to the lifecycle of the resource that it was enabled

Azure Resource is assigned a Managed Identity
Managed Identity establishes a Service Principal within Azure
Azure Resources talk to the IMDS (Instance Metadata Service) to get tokens in order to invoke actions against other services

App Service > Identity > System Assigned > Change status to "ON"


[ User Assigned ]
- created as a standalone resource
- can be shared with other resources/services
**user-assigned managed identities can only be assigned to resources hosted in Azure Cloud!


[ Service Principal ]
- acquired through registering my applicaiton
- the registration represents my app within my Azure AD Tenant


Microsoft Authentication Library - MSAL
-----------------------------------------------------
// TODO



Governance
----------------

[ Org Strucuture ]

Azure Tenant
  Subscriptions 
     Resource Groups
     
**tags can be applied at the sub, rg, and resource level 

[ Management Groups ]
- allows us to apply policies easily to subscriptions 

Root Management Group
  top of the hierarchy 
  policies applied here are "global"

Management Group Hierarchy
  up to 6 levels 
  one management group can have multiple children 
  one mg sub can only have one parent 

Subscriptions 
  function like the "children"
  policies flow down to the subs

[ Azure Policy ]

Monitoring for a condition 
  does the resource “location” property = “US West”?

Trigger
  what to do if the condition is met
  append, audit, deny, modify 

Assignment 
  policies must be assigned to a scope 
  management group, subscription, resource group, resource 

[ Initiatives ] 
- an object that ties together multiple policies in order to achieve an overall goal 

// Example
Location (Scope): Low Dev Subscription
Name: Allowed Locations
Definitions (Policies): 1) allowed locations 2) allowed locations for resource groups 

[ Blueprints ]
// TODO

Networking
--------------

[ Availability Zones ] 
- 3 availability zones per region
	
[ Virtual Networks ] 
- lose 5 addresses with each subnet
- for Gateway subnets it's best to provision a /27 (32 addresses) so you can run Express Route and S2S VPN
- Express Route is not encrypted 
- default paths are 1) intra-vnet traffic 2) internet connectivity
- peering now allows for routing to be automatically configured from both Vnets using the wizard
- peering can happen across region and subscriptions (must know resource-id)
- non-transitive

[ Network Security Groups - NSG ] 
- focused on filtering traffic, not routing
- can be applied to subnets (preferred) or NICs
- cannot remove Default Rules
- can modify based on "Priority" (lower the number, higher the priority)
- by default ALL INBOUND ACCESS is enabled on a "Basic" SKU Public IP
- by default ALL INBOUND ACCESS is blocked on "Standard" SKU Public IP
-  SERVICE TAGS abstract references to Azure services since recording IP addresses for those services is complex

[ Application Security Groups ] 
- think AWS Security Groups
- logical container for network interfaces
- NICs are associated with ASGs
- "Web-ASG" would apply to the NIC of all VMs in the "Web Fleet"
- ASGs are scoped to Vnets; all NICs must be in the same Vnet

[ Routing ]

Routing Tables
	Default Routes
	User Defined Routes (UDR)


[ Azure Firewall ] 
- must be deployed to a dedicated subnet called "AzureFirewallSubnet" /26 is the minimum
- must be deployed in the same resource group that the VNET is in
- fronted by a loadbalancer and backed by a VM scale set
- logs can be exported a Log Analytics Workspace (Diagnostic Settings)
- one Firewall per VNET
- VNETs can share a Firewall
- works by creating a user-defined route to set the Firewall as the default route instead of the VNET router
- can configure outbound HTTP/s traffic by FQDN
- can perform SNAT and DNAT through the Firewall
- provides threat intelligence out-of-the-box
- integration w/ Azure Monitor
- can associate up to 250 public IPs assigned
- custom routes (user defined routes) must be in place to route traffic from VMs to the Firewall Service

// SKUs
Standard
	Premium 

// Rules
Network Rule Collection
	focused on outbound traffic
	basic source/destination rule-sets (similar to NSGs)

Application Rule Collection
	focused on outbound traffic
	layer 7 filtering (FQDN)
	allow http/https traffic from ANY to www.google.com with a rule named "google-allow"

NAT Rule Collection
	focused on in-bound traffic


[ Azure Bastion ]
- must be deployed to a dedicated subnet called "AzureBastionSubnet" (/26 is the minimum)
- RDP/SSH sesions are wrapped in a SSH tunnel via the Bastion Service
- supported by a loadbalancer and VM scale set on the backend
- I can determine how many concurrent sessions I want to support

// SKUs
Basic
	Linux - SSH
	Windows - RDP
	
Standard
	IP based connections
	Custom Ports/Protocols
	File Transfer
	
	
[ Just-In-Time Access - JIT ]
- can go to a resource and request access for only my IP when I need it

Security Center -> Just-In-Time VM Access


[ Transitive Connectivity ]
- VPN Gateways can be used to establish connectivity between V-Nets and on-prem networks
- VPN Gateway resources are deployed into a special subnet called "Gateway Subnet"
- connections are terminated over the internet (public IP address)
- Allow Forwarded Traffic
- Allow Gateway Transit must be enabled in the hub vnet to pass traffic transitively to other spoke vnets
- Use Remote Gateway must be enabled in the spoke vnet to tell it to use the gateway that is configured in the hub vnet


[ Service Endpoints ]
- configured at the subnet level of a Vnet
- provides a new "private" route for resources in the vnet to reach Mircosoft services
- provides the private address as a source IP address when accessing services
- DOES NOT establish private IP address for the services being accessed (like Private Link)
- not all services support service endpoints so check before implementing


[ Private Link ] 
- private IP addresses within a subnet that point to a particular service
- no longer need to expose the microsoft service publicly (e.g. your storage account)
- other connected VNets or on-prem networks can access services in your VNet using private addressing


[ WAN Connectivity ] 

Point-to-Site
	download a VPN Client
	single connection from a single device

Site-to-Site
	traditional IPSec conncetion between (2) border devices
	VPN Gateways are provisioned on the Azure side
	Local Gateways are configured in Azure to represent on-premise (customer) devices
	different SKUs for features/performance
	
ExpressRoute
	does not connect to a region
	connects to the Microsoft backbone
	you can get to any region

// Types
Private Peering
	access to private VNETs and private services

Microsoft Peering
	access to public facing services (Storage Account)
	


Compute (Virtual Machines)
------------------------------------

[ Instance Families ] 

B, Dsv3, Dv3, Dasv4, Dav4, DSv2 - General Purpose -> AWS T/M Family
Esv3, Ev3, Easv4, Eav4, Ebdsv5, Ebsv5 - Memory Optimized -> AWS R/Z Family
F, Fs, Fsv2, FX - Compute Optimized -> AWS C Family
HB, HBv2, HBv3, HC, H - High Performance Compute -> AWS P Family
L - Storage Optimized -> AWS L/D Family


[ Images ]
- decide how much I want to "bake-in" to the image and how much bootstrapping I want to handle outside of the instance post provisioning
- handled via sysprep.exe (Windows) and sudo waagent -deporivision+user (Linux)
- highlight a VM > Capture


[ Proprietary Operating System ]
- Mariner OS (think AWS Linux 2)
- AKS Node OS support


[ VM Scale Sets ]
- think AWS Auto-Scaling Groups, Google Managed Instance Groups


[ Availability Sets ] 


[ Managed Disks ] 
-  as capacity goes up, so does performance (I/O, throughput)

// Types
Standard HDD

Standard SSD

Premium SSD
	can increase the performance tier w/o making the disk bigger
	can also lower it again

Ultra Disk
	Capacity
	IOPS/Throughput can modified independently of capacity -- UNIQUE
	
	
[ Azure DevTest Labs ]
- a service for easily creating, using, and managing virtual machines in labs
- Labs offer preconfigured bases and artifacts for creating VMs

// Concepts
Lab - a group of resources to be managed together (e.g VMs)
  Policies - controls in place to manage cost (e.g. automatic shutdown time, limit VMs instance families)
    Repositories - users can use artifacts and templates from public and private Git repositories to create to create resources
      Artifacts - specify actions to take to provision a VM, such as running Windows PowerShell scripts, running Bash commands, or installing software


Storage Solutions
-----------------------
 
[ Storage Account ]
- foundation layer for all things storage
- associated with a resource group
- encrypted-at-rest by default (using Microsoft managed key) -- GCP does this as well
- all storage account services come with public endpoints by default
- use Storage Explorer to browse Storage Accounts
- RBAC support
- ABAC support (Attribute Based) -- think tagging storage accounts/containers

// Concept
Storage Account (bucket)
	Container (folder)
		Files (objects)


// Storage Account Options
Location
	US East
	
Kind
	StorageV2 (general purpose v2)
	BlockBlob Storage
	File Storage
	
Performance
	Standard
	Premium
	
Replication
	LRS
 	ZRS
 	GRS
 	RA-GRS

Access Tier
	Hot (instant access)
	Cool (instant access)
	Archive (delayed access -- 1+ hours)
	
 	
// Storage Account Services
Azure Blobs
	object oriented storage (similar to S3)
	snapshot support; point-in-time instance of an object
	version support; maintains multiple copies of an object

Azure Files 
	traditional file sharing services; designed for SMB/NFS connectivity; default quota is 5TB
	internal access: REST, SMB 2.1 and SMB 3.0
	public internet: REST, SMB 3.0
	snapshot support; point-in-time instance of a file

Azure Tables 
	simple storage for non-relational semi-structured data (key/value store)

Azure Queues 
	simple messaging service (similar to SQS)
	FIFO based

Naming convention is as follows:
<storageaccountname>.<service>.core.windows.net

lowsandbox.blob.core.windowns.net
lowsandbox.files.core.windows.net
lowsandbox.files.queue.windows.net
lowsandbox.table.core.windows.net


[ Storage Account Replication ] 

Local Redundant Storage (LRS) 
	3 copies of data within a SINGLE data center

Zone Redundant Storage (ZRS)
	3 copies across (3) availability zones in the primary region
	
Geo Redundant Storage  (GRS) 
	3 copies across within a SINGLE data center and x3 async copies into another region 
	
Geo Zone Redundant Storage (GZRS)
	3 copies across (3) availability zones in the primary region and x3 copies in another region

**Forced Failover - the ability to tell Azure to update the underlying storage account DNS record to point to the secondary endpoint instead of the primary; check "Last Synced Time"; only supported in GRS or RA-GRS


[ Storage Account Security ] 
- all storage account services come with public endponts by default

Storage Firewall
	shapes network access to storage accounts

Access Keys
	gives a user/service full management and data layer access 

Shared Access Signatures (SAS)
	a URI that describes what a types of permission a user/service has; permissions cannot be modified after the SAS is generated
	sv = signed version
	sr = signed resource >> b=blob bv=blobversion bs=blobsnapshot c=container d=directory
	sp = signed permissions
	
// Types of SAS 
Service SAS - specific to one service (blob, table, queue, files)
Account SAS - specific to the storage account level

// SAS Policies


Role Based Access (RBAC)
	provides access based to the management and data layer based on Azure Active Directory
	
- Create a "Service Principal" (AAD Dashboard > App Registration)
- Register an application in AAD by giving it a secret
- Associate the service principal with a role (Access Control IAM)
- a successful login by the app (via the api) returns a "token" that the app can then use to pass to a service to perform an action 


SQL Databases
---------------------

Structured Data Options (rows and columns)

[ Azure Database for PostgreSQL ]

// Deployment Modes
Single Server
Flexible Server
Hyperscale (Citus)

[ Azure Database for MySQL servers ]

// Deployment Modes
Single Server
Flexible Server
	
[  Azure SQL Database ]
- supports "some" SQL features but not all

Autoscale

Service Tiers
	General Purpose
	Business Critical (Always-On Availability Group)
	Hyperscale (Sharding)
	
// Pricing
DTU
	Data Transaction Unit (represents CPU, memory, IOPS)
	pricing per database
	limited compute, memory, IO
	includes backups, patching, HA

vCore
	more control over resources
	pricing per database
	supports Managed Instances
	higher resource limits
	includes backups, patching, HA

	

[ Azure SQL Elastic Pool ] 
- allows you to put multiple databases in a single logical SQL Server and all of the databases share the resources of the server
- resource allocation for each database is managed dynamically by the service
	
[  Azure SQL Managed Instances ]
- PaaS offering within your VNET
- supports most SQL features
- has many features not available in Azure SQL (i.e. SQL Server agent)

[  Azure SQL Single Database ]
- can only create (1) database

[  Azure SQL Edge ]
- very lightweight
- optimized for IOT
- 500mb memory footprint




	
No-SQL Databases
--------------------------

Semi Structured Options (JSON, XML)

[  Azure Tables  ]
- backed by an Azure Storage Account
- stores data that may change structure as "entities" in tabular format (semi-structured)
- focuses on storing a lot of data at a low price point 
- pricing is determined per GB of storage
- 20k operations per second
- latency guarantees

Partition Key - functions like Cosmos DB
Row Key - must be included with every entity

**these properties must be referenced in any query in order for data to be returned

[  Azure Cosmos DB ]
- NoSQL database engine 
- Supports local firewall settings (IP whitelisting)
- Supports private or public endpoints
- Multi-model (key/value pairs, documents, graphs, columnar)
- Global scale performance 
- can hot add or remove regions on demand w/ no interruption -- UNIQUE
- Active/Active across regions (multi-master)
- multi-region
- different consistency models (strong, eventual)

// Supported APIs
SQL
MongoDB
Cassandra 
Table (key/value)
Gremlin (graph)

// Constructs	
Cosmos Account (where the API is defined)
  Database (where throughput is defined)
    Container (where the data lives (partition key is defined here)
      Item (the actual data)
      
Logical Partitions - formed based on the value of a partition key that is associated with each item in a container. All the items in a logical partition have the same partition key value; In addition to a partition key that determines the item's logical partition, each item in a container has an item ID which is unique within a logical partition. Combining the partition key and the item ID creates the item's index, which uniquely identifies the item. A logical partition consists of a set of items that have the same partition key.

Physical Partitions - Internally, one or more logical partitions are mapped to a single physical partition. Typically smaller containers have many logical partitions but they only require a single physical partition.

// Keys

Partition Key - It's the best practice to have a partition key with many distinct values, such as hundreds or thousands (high cardinality) 
Unique Key

*Partition keys are immutable! Containers must be deleted if you want to change them

US customer data -> Server 1
Canada customer data -> Server 2

// Consistency Levels (High > Low)

Strong 
	Bounded Staleness
		Session
			Consistent Prefix
				Eventual

// Pricing
Request Units (RUs)  - abstract way to measure/charge for resources required to interact w/ data
Cosmos appends an "item id" with each document in order to identify each unique document (1 document = 1 RU)

Point Read - requesting (1) item
In-Partition - requesting data located in a single partition (WHERE CUSTOMER = US)
Cross-Partition -  requesting data located in more than one partition (US and Canada)

// Replication
- replicates data seamlessly between regions (read replicas)
- multi-region writes (read/write replicas)

[ Azure Redis Cache ]
-  in-memory data store based on the Redis software
-  can be used as a distributed data or content cache, a session store, a message broker

// Key Expiration
- set an expiration value on your keys
- an expiration removes keys proactively instead of waiting until there's memory pressure
- when eviction happens because of memory pressure, it can cause more load on your server

// Eviction Policy
Volatile-lru
	default policy
	only keys that have a TTL value set with a command like EXPIRE are eligible for eviction
	
Allkeys-lru
	evicts any keys under memory pressure


Data Services (Big Data)
---------------------------------

[ Azure Data Explorer - ADX ]
// TODO

[ Kusto Query Language - KQL ]
// TODO

[ Azure Data Factory ]
- serverless ETL and data integration service that can help me create/schedule data-driven workflows (pipelines) that can ingest data from a variety of data stores
- used to orchestrate data movement
- can transform data at scale (mapping)

// Workflow
Connect And Collect
	Transform and Enrich
		CI/CD and Publish
			Monitor
			
Integrated Runtimes (Infra used to run pipelines) -> Linked Services (Connections to data sources) -> Data Sets (Data you are working with)
			
20,570 (6 Nifi EC2's) 

[ Azure Data Lake ]
- provides a repository where you can upload and store huge amounts of unstructured data with an eye toward high-performance big data analytics
- primarily designed to work with Hadoop and all frameworks that use the Apache Hadoop Distributed File System (HDFS) as their data access layer
- Data Lake Storage Gen2 builds on Azure Blob storage capabilities to optimize it specifically for analytics workloads
- supports RBAC for security
- can handle ad hoc data in batches or streaming data


[ Azure Data Bricks ]
- Big Data and Machine Learning platform, which empowers developers to accelerate AI and innovation
- managed Apache Spark platform

// Environments //

Databricks SQL
	for analysts who want to run SQL queries on their data lake, create multiple visualization types to explore query results from different 
	perspectives, and build and share dashboards.

Databricks Data Science & Engineering
	an interactive workspace that enables collaboration between data engineers, data scientists, and machine learning engineers
	used to read data from multiple data sources and turn it into breakthrough insights using Spark

Databricks Machine Learning
	integrated end-to-end machine learning environment incorporating managed services for experiment tracking, 
	model training, feature development and management, and feature and model serving.


[ Azure Synapse Analytics ]
- comprehensive workspace that manages the data integration life-cycle from end-to-end (single pane of glass)
- uses familiar services on the backend like Azure Data Lake, Data Factory, etc
- 

[ Azure Purview ]
- provides insight into my data estate
- data can exist nearly everywhere (on-prem, other clouds, etc)
- answers questions about classification, lineage

[ Microsoft Fabric ] 
// TODO





Hosting Platforms
-------------------------

[ Azure Static Web Apps ]
- automatically builds and deploys full stack web apps to Azure from a code repository
- focus on light frontend frameworks like React, Angular, Next.js, Remix.js
- support backends (APIs) for server side processing w/ Azure Functions, App Service, ACI


[ Azure App Service ]
- provides fully managed hosting for HTTP based web applications and backend APIs
- applications may be deployed using code or containers
- supports running workloads on both Linux or Windows

// Concept
App Service Plan (defines a set of compute resources for a web app to run on)
	App
	
**Plans define OS, region, number of VMs, size, pricing tier (Free,Shared, Basic, Standard, Premium, etc)

// Deployment Slots
- live apps with their own host names
- app content and configuration elements can be swapped between two deployment slots, including the production slot
- this enables deployment strategies like Blue/Green
- supports traffic splitting between deployment slots




Container Platforms
---------------------------

[ Azure Container Registries ]
- managed registry service based on the open-source Docker Registry 2.0
- supports Helm Chart storage
- control access to a container registry using Azure AD, service principals, or a provided admin account.
- use Azure RBAC to assign users or systems fine-grained permissions to a registry

// Service Tiers - SKUs // 
Basic
	for those just getting started w/ Registries
	low storage usage
	
Standard
	same as Basic
	increased storage and image throughput
	
Premium
	supports geo-replication
	supports private link with private endpoints
	
// Best Practices //
- place registries in the same region as your workloads
- place registries in their own resource group


// ACR Tasks //
- enables automated builds triggered by source code updates, updates to a container's base image, or timers

Quick task
	build/push a single container image to a container registry on-demand without local Docker installation
	
Trigger On Source Code Update
	triggers a container image build or multi-step task when code is committed, or a pull request is made or updated
	
Trigger on Base Image Update
	set up an ACR task to track a dependency on a base image when it builds an application image
	when the updated base image is pushed to your registry, or a base image is updated in a public repo such as in Docker Hub, ACR Tasks can automatically build any application images based on it
	with automatic detection and rebuilding, ACR Tasks saves you the time and effort normally required to manually track and update each and every application image referencing your updated base image.
	

[ Azure Container Instance - ACI ]
- similar to Google Cloud Run
- fastest and simplest way to run a container in Azure
- exposes my container groups directly to the internet with an IP address and a fully qualified domain name (FQDN)
- can deploy within a pre-defined Vnet; must be deployed to a delegated subnet (no other resources in it)
- concepts like scale, load balancing, and certificates ARE NOT provided with ACI containers
- to scale to five container instances, you create five distinct container instances


[ Azure Container Apps ] 
- enables me to run microservices and containerized applications in a serverless Kubernetes-centric way
- access to HTTPs ingress for my app
- autoscaling with the ability to SCALE TO 0
- split traffic across multiple versions
- access to Kubernetes microservice enhancer like Daper
- pull containers from ANY registry (public/private)
- can deploy within a pre-defined Vnet
- logs for containers are sent to a Log Analytics Workspace
- custom port exposure -- PREVIEW

// Constructs
Container App Environment (secure boundary around a group of container apps)
	Container App (workload)
	

[ Azure Kubernetes Service - AKS ]
// TODO

[ Azure Defender For Containers ] 
// TODO





Functions
-------------

[ Azure Functions ]
- think AWS Lambda, Cloud Functions
- supports local development environment
- a function must have exactly one trigger

// Bindings
- stored in function.json file

"bindings":[
        // ... bindings here
        {
            "type": "bindingType",
            "direction": "in",
            "name": "myParamName",
            // ... more depending on binding
        }
    ]
    



[ Azure Durable Functions ] -- NEW UNIQUE
- extension of Azure Functions
- allows me to write STATEFUL functions 
- functions that can run for extended periods of time or that depend on other async actions kicking off

// Types of Functions
Orchestrator functions - describe how actions are executed and the order in which actions are executed
Activity functions - the basic unit of work in a durable function orchestration (e.g. checking orders, sending notifications)
Entity functions - define operations for reading and updating small pieces of state
Client functions - 


[ Logic Apps ]
- a platform for citizen developers that allows them to put together functionality through a simple drag and drop UI (designer)
- Power Automate is built on top of Logic Apps
- associated with a resource group and have a hosting plan (think Azure App Service)
- can be triggered via events or run via a schedule 
- supports hooking into custom snippets of javascript if connectors don't suffice 

// Plans //
Standard - 
Consumption -	pay only for the work that is done (most popular)

// Connector Types //
Built-in 
	Enterprise
		Custom
	


Azure Update Management
------------------------------------
- functions like AWS SSM Patch Manager

Log Analytics Agent reports package status -> Automation Account
Hybrid Runbook Worker check for maintenance window and deployment
If there are updates that need to be applied, it executes the necessary commands (can configure pre/post actions)

Automation Account > Update Management


Azure Backup
-------------------
- Backup-As-A-Service
- Supports files, folders, machine state, and app-aware backups (i.e SQL)

// Concept
Recovery Services Vault (repository for backup data)
  Workload (windows, linux, SQL)
     Backup Agent (installed on the OS)
     

Microsoft Azure Recovery Services (MARS) Agent
- windows only
- supports file, folder, and system-state backups
- three times per day

Microsoft Azure Backup Server (MABS)
- windows/linux
- supports traditional style backups
- supports file/folder, application aware, system-state backups
- customize backup frequency

Azure Virtual Machine Backup Extension
- windows/linux
- uses virtual machine extension to backup a virtual machine
- restores virtual machine, disks, and files
- once per day

Microsoft Data Protection Manager (DPM)
- on-prem backup solution
- supports tape


Azure Site Recovery
---------------------------
- recover from a region/site failure
- automated recovery processes
- supports windows/linux

// Concept
Replicated Items (workloads that are replicated)
  Replication Policies (recovery point objectives and recovery point retention)
    Replication Plans
    

Load Balancing
--------------------

[ Azure Load Balancer ]
- layer 4 distribution
- session affinity, health checks
- public/private
- port forwarding
- SNAT for outside access via the Load Balancer
- can associate multiple public IPs
- can associate VMs or scale sets to backend pool

Basic SKU
	TCP
	HTTP
	
Standard SKU 
	TCP 
	HTTP + HTTPS

Health Probes
Load balancing Rules
Inbound NAT Rules
Out Rules


[ Azure Application Gateway ]
- layer 7 distribution
- must be deployed to a dedicated subnet called "AppGatewaySubnet" /27 is the minimum

Standard V2 SKU
	static public IP
	
[ Azure Application Gateway for Containers ] -- PREVIEW
- an abstraction to the Gateway Kubernetes object (think Ingress)
- provisions two pods in the AKS cluster: Controller + Bootstrap in the azure-alb-system namespace
- the controller pod talks to the Azure Application Gateway for Container
- this allows changes to be made on the data plane in subseconds; much faster than ARM provisioning

// Components
Frontend IP - public IP used to listen for incoming traffic 
	Association - used to map a front-end IP to a subnet in a particular VNET to send traffic to (data path); technically this is a subnet where an AKS cluster would be

[ Azure Traffic Manager ] 
- providing high availability across regions
- primarily DNS driven
- can route to many different endpoints (azure services, load-balancers, services outside of Azure)

Client makes request to www.lowsandbox.com (Traffic Manager) -> TM responds with an IP (DNS Lookup) -> Client then goes direct to the service

How does the Traffic Manager decide what IP address to send back to the client?

Routing Methods
	Priority
	Weighted
	Performance
	Geographic
	Multi-value
	Subnet

http://lowsandbox.trafficmanager.net  // Entrypoint


[ Azure Front Door - CDN ] 
- think AWS Cloud Front
- Microsoft global edge network
- can integrate with services such as App Service, Storage


[ Web Application Firewalls ] 
- sit in front of application gateways and front door deployments
- application gateway protection => virtual network level in your regions
- front protection => outside the vnet, at the edge
- web application firewalls are enabled inside of the application gateway and front door service settings
- WAF polices can be associated at the application gateway level or at the listener level


Automation
---------------

[ ARM Templates ] 
- resources are deployed to a resource group
- two different deployment modes
- Complete: everything in the template must match what is in the resource group; if there is something in the template that is not in the resource group it will be deleted
- Incremental: if resource does not exist in the resource group, it will be created; if the resource already exist, it will be updated; no resources are deleted
- can be deployed via Powershell, AzureCLI, the portal, VSCode
- you can auto-generate a template by using the "Export Template" option on an existing resource group 

**Great 3rd party tooling includes Pulumi and Bicep

[ Runbooks ] 
- similar to CloudFormation/Lambda
- supports Powershell or Python scripting
- simplify orchestration of complex multi-step tasks
- you must install/enable the modules under the "Shared Resources" section for the resources that you want to interact with (e.g. Az.Compute for VMs)

// Concept
Automation Account
  Run As Account (created in your Azure tenant for privileges)
      Automation Runbooks
         Automation Worker


Monitoring 
---------------

[ Azure Monitor ]
- multi-faceted solution comprised of several separate and distinct services
- diagnostic settings can be configured for multiple types of resources/services that define what data you want to send and where you want to send it
- to send logs to Log Analytics -> Log Analytics Agent
- to send logs to Azure Monitor -> Azure Diagnostics Agent

Diagnostics Agent
Log Analytics Agent
Dependency Agent

**Can configure Availability Test on web applications (simple ping and advance multi-step test) -- UNIQUE (GCP does this to)

// Azure Monitor Agent - AMA
- collects monitoring data from the guest operating system of Azure VMs, Hybrid VMs, and VM Scale Sets
- delivers data to Log Analytics Workspaces, Azure Monitor for use by features, insights, and other services, such as Microsoft Sentinel and Microsoft Defender for Cloud
- must use a System Assigned Managed Identity to talk to Log Analytics Workspace
- replaces all of Azure Monitor's legacy monitoring agents
- data shipping is managed via "Data Collection Rules"

Azure Monitor > Data Collection Rules

## Data Collection Rules 
What? Counters || Logs
Where? Azure Monitor || Log Analytics Workspace

		

[ Metrics ]
- small, time-based data
- collected a regular intervals
- sent to Azure Monitor for high level dash-boarding and reporting
- sent to Log Analytics for advance querying capability
- sent to Event Hub

[ Logs ]
- large, often verbose information
- collected sporadically
- sent to Log Analytics workspaces for detailed viewing of the text data
- sent to Event Hub
- sent to Storage for long term archiving


[ Activity Logs ] 
- scoped to subscription level events (create, delete, update) -- i.e. AWS CloudTrail
- only displays WRITE operations
- stored for 90 days by default


[ Alerts and Action Groups ] 

target resource to monitor (VM)
  condition (CPU)
    action group (action to take once the alert triggers)
      email, SMS, push notification, voice call, invoke Azure Function, invoke Logic App, call a WebHook, integration with ITSM, invoke Runbook


[ Log Analytics Workspace ] 
- workspaces are deployed geographically

Workspace
  Data Sources
      Analytics
      
[ Azure Monitor Insights ] 
- prepackaged monitors for specific services (e.g. Azure VMs, Containers, SQL, etc)

VM Insights
	Network Insights
		Container Insights
			App Insights (instrumentation library must be integrated into project)
			
			
// App Insight Categories

Users - how many people used your app
Session - how may sessions included certain pages
Events - how often certain pages and features are used
Retention - how often users return to use the app
Impact - analyzes how load times and other properties influence conversion rates for various parts of your app
**Open Telemetry support -- IN PREVIEW


Security
---------------

[ Azure Security Center ]
- provides recommendations on how to improve security posture (like AWS Config)
- can tie into workflow automation (via Logic Apps) to do something when certain conditions or alerts are raised

[ Azure Sentinel ]
- a scalable, cloud-native solution that provides Security information and event management (SIEM)
- Security orchestration, automation, and response (SOAR)
- sits on top of an Log Analytics Workspace
- allows me to investigate threats with artificial intelligence
- comes with many connectors for Microsoft solutions that are available out of the box and provide real-time integration
- supports Azure services like Azure AD, Azure Activity, Azure Storage, Azure Key Vault, Azure Kubernetes service, and more

// Questions
- Can Sentinel scale beyond a single subscription? At this time it's one Azure Sentinel Workspace per Tenant, Azure Sentinel works across subscriptions?
- Can a Log Analytics Workspace ingest data from multiple subscriptions? Seems as though a Workspace can support multiple subscriptions as long as it is under the same Azure AD Tenant?

[ Microsoft Defender for Cloud ]
- a Cloud Security Posture Management (CSPM) and Cloud Workload Protection Platform (CWPP) for Azure, on-premises, and multi-cloud (Amazon AWS and Google GCP) resources
- can monitor multiple subscriptions under one tenant
- provides a score for my overall environment (think AWS Config)
- provides access to defender plans for specific services (App Service, Container Apps, etc)
- these plans cost money per month/server

// Versions
Free
	include the Azure security benchmark


Events 	
----------

[ Event Grid ] 
- events are generated from Azure Services (i.e Storage, Subscription, Resource Group) -> Event Grid -> Handler (i.e Azure Function, Service Bus, Logic App, Azure Automation)
- must create a namespace
- must create a "Topic" in order to send events to Event Grid


[ Event Hub ] 
- managed big data streaming platform and event ingestion service
- can process millions of events per second
- mainly used to collect data from IoT devices
- must enable "data capture" to deliver streaming data to Event Hub -> Azure Blob or Azure Data Lake Storage

// Concepts
Event Hub Client
	Event Hub Producer
	Event Hub Consumer

Partition
	order sequence of events held in Event Hub
	


Asynchronous Messaging 
----------------------------------

[ Azure Queues ] 
- basic FIFO
- supports messages up to 64 KB in size
- commonly used to create a backlog of work to process asynchronous
	
[ Azure Service Bus ] 
- supports queues, publish/subscribe (topics and subscriptions), and other advance patterns
- suited for more complex use cases
- mainly for micro-service implementation (support dead-letter queues, etc)
- supports messages up to 256 KB in size
- supports advance filtering for subscribers

// Concepts
Service Namespace
	Service Bus Queue
	
	
	
API Management
------------------------

[ Azure API Management ]
- fully managed API service (i.e AWS API Gateway)
- highly configurable

// Policies
- can change API behavior through configuration using policies
- policies are a collection of statements that are run sequentially on the request or response of an API
- format for policies is XML
- policies include things like rate-limit by key or by subscription

Rate Limits - usually used to protect against short and intense volume bursts

<rate-limit calls="number" renewal-period="seconds"> -- per the subscription as a whole
<rate-limit-by-key calls="number" renewal-period="seconds" -- per individual subscribers
                   increment-condition="condition"
                   increment-count="number"
                   counter-key="key value" 
                   retry-after-header-name="header name" retry-after-variable-name="policy expression variable name"
                   remaining-calls-header-name="header name"  remaining-calls-variable-name="policy expression variable name"
                   total-calls-header-name="header name"/> 
                   

Quotas - used for controlling call rates over a longer period of time (e.g. month)

<quota calls="10000" bandwidth="40000" renewal-period="3600" /> -- per the subscription as a whole
<quota-by-key calls="10000" bandwidth="40000" renewal-period="3600"  -- per individual subscribers
                  increment-condition="@(context.Response.StatusCode >= 200 && context.Response.StatusCode < 400)"
                  counter-key="@(context.Request.IpAddress)" />


Set Quota

// Versions & Revisions
Versions - allows me to expose breaking changes for my API; requires publishing for changes to go live
Revision - allows me to add non-breaking changes to my API; users can consume the new changes using a diff query string on the same endpoint; 


Secrets Management
-----------------------------

[ Azure Key Vault ] 
- functions like Secrets Manager in AWS
- the endpoint for your vault can be set to public or private
- handles the provisioning, storage, and rotation of SSL/TLS certificates (think AWS Certificate Manager)

KeyVault (container - HSM w/ API)
  Secret Information (secrets, keys, certificates, etc)
     Access Policies (security)
     
     
[ Azure App Config ]
- complements Azure Key Vault
- provides a service to centrally manage application settings and feature flags
- regional service scope
- can perform bulk import of settings into the service
- can export key-values from the service



Multi-Cloud + On-Prem
------------------------------
[ Azure Arc ]

[ Azure ArcBox ] -- NEW
-  automated toolbox implementation
- deploys a resource group that contains a VM that host the following resources:
- a virtual machine (Windows 2K25)
- virtualization is enabled that deploys (2) linux VMs and (1) windows system with Azure Arc agents installed
- all resources communicate with the Azure Arc for management and metrics
- this toolbox gives me the opportunity to quickly iterate and experiment with Azure Arc services


[ AWS Connector - Preview ]
- makes API calls from the Azure Control Plane
- requires 2 IAM roles
- gives option to add an organization account or a single account

// Solutions

Inventory 
	allows you to see resources from other clouds in a single view
	set a period sync interval (e.g. 1 hour)
	
Arc Onboarding
	extends Azure Arc so I can use Azure management services on EC2 instances
	must add a tag with the value “Arc” to be included
	
	





